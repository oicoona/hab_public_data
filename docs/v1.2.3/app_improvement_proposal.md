# 대구 공공데이터 시각화 앱 개선 제안서 (v1.2.2 → v1.2.3)

**문서 버전**: v1.2.3
**작성일**: 2025-12-08
**참고 문서**: `docs/v1.2.3/note.md`

---

## 1. 개요

본 문서는 대구 공공데이터 시각화 앱 v1.2.2의 현재 상태(AS-IS)와 v1.2.3에서 목표하는 개선 상태(TO-BE)를 비교 분석한다.

v1.2.3의 핵심 목표:
1. **문서화 강화**: README.md에 도구 목록 상세 작성
2. **코드 구조 개선**: 프롬프트 모듈화 (`utils/prompts.py`)
3. **코드 품질 향상**: 불필요한 import 및 함수 정리
4. **기능 확장**: 배치 ECLO 예측 지원 (N개 데이터 동시 추론)

---

## 2. 기능별 AS-IS / TO-BE 비교

### 2.1 문서화 (README.md)

| 구분 | AS-IS (v1.2.2) | TO-BE (v1.2.3) |
|:-----|:---------------|:---------------|
| **도구 목록** | 간략한 설명만 존재 | 21개 도구 상세 설명 (파라미터, 사용 예시) |
| **프로젝트 구조** | 일부 누락/오류 가능 | 전체 검토 후 정확한 구조 반영 |
| **사용 가이드** | 기본 실행 방법만 | ECLO 예측 사용법 추가 |

---

### 2.2 프롬프트 모듈화

| 구분 | AS-IS (v1.2.2) | TO-BE (v1.2.3) |
|:-----|:---------------|:---------------|
| **프롬프트 위치** | `chatbot.py` 내 하드코딩 | `utils/prompts.py`로 분리 |
| **관리 용이성** | 수정 시 코드 전체 검토 필요 | 프롬프트만 독립적으로 관리 |
| **문서화** | 주석 없음 | 각 프롬프트별 용도/사용처 주석 |

#### 2.2.1 신규 모듈 구조

```python
# utils/prompts.py

# 메인 시스템 프롬프트 (chatbot.py에서 사용)
SYSTEM_PROMPT = """..."""

# ECLO 예측 관련 프롬프트 (chatbot.py SYSTEM_PROMPT에 포함)
ECLO_PREDICTION_PROMPT = """..."""

# 도구별 docstring 템플릿 (tools.py에서 참조)
TOOL_DESCRIPTIONS = {
    "predict_eclo": """...""",
    ...
}
```

---

### 2.3 코드 리팩토링

| 구분 | AS-IS (v1.2.2) | TO-BE (v1.2.3) |
|:-----|:---------------|:---------------|
| **불필요한 import** | 미사용 모듈 존재 가능 | 전체 점검 후 정리 |
| **미사용 함수** | 레거시 함수 잔존 | 사용되지 않는 함수 제거 |
| **코드 일관성** | 일부 불일치 | 스타일 통일 |

---

### 2.4 배치 ECLO 예측

| 구분 | AS-IS (v1.2.2) | TO-BE (v1.2.3) |
|:-----|:---------------|:---------------|
| **예측 단위** | 1개 데이터만 가능 | N개 데이터 동시 예측 |
| **입력 방식** | 단일 사고 정보 | 여러 행 데이터 입력 가능 |
| **출력 형식** | 단일 결과 | 테이블 형태 다중 결과 |

#### 2.4.1 배치 예측 시나리오

**AS-IS (v1.2.2)**
```
사용자: 2022-01-01 토요일 맑음... ECLO 예측해줘
AI: ECLO 값: 1.5827 (단일 결과)
```

**TO-BE (v1.2.3)**
```
사용자: 다음 3개 사고에 대해 ECLO 예측해줘:
1. 2022-01-01 토요일 맑음 수성구 상동...
2. 2022-01-02 일요일 비 중구 동성로...
3. 2022-01-03 월요일 흐림 달서구 상인동...

AI: ## ECLO 예측 결과 (3건)

| # | 일시 | 장소 | ECLO | 심각도 |
|---|------|------|------|--------|
| 1 | 2022-01-01 | 수성구 상동 | 1.58 | 매우 심각 |
| 2 | 2022-01-02 | 중구 동성로 | 0.82 | 심각 |
| 3 | 2022-01-03 | 달서구 상인동 | 0.45 | 일반 |
```

---

## 3. 코드 품질 개선

### 3.1 불필요한 코드 정리 대상

| 위치 | 점검 항목 | 심각도 |
|:-----|:---------|:-------|
| `app.py` | 미사용 import 확인 | 🟡 Performance |
| `utils/chatbot.py` | 레거시 함수 (create_chat_response 등) | ⚠️ Warning |
| `utils/tools.py` | TOOLS 리스트 (deprecated) | ⚠️ Warning |
| `utils/visualizer.py` | 미사용 함수 확인 | 🟡 Performance |

### 3.2 프롬프트 분리 대상

| 현재 위치 | 프롬프트 | 분리 후 |
|:---------|:--------|:--------|
| `chatbot.py:24-86` | SYSTEM_PROMPT | `prompts.py:SYSTEM_PROMPT` |
| `tools.py:922-946` | predict_eclo docstring | `prompts.py:ECLO_TOOL_DESCRIPTION` |

---

## 4. 변경 요약표

| 영역 | 변경 유형 | 내용 |
|:-----|:---------|:-----|
| README.md | 🔧 개선 | 21개 도구 상세 목록 추가 |
| README.md | 🐛 수정 | 프로젝트 구조 오류 수정 |
| utils/prompts.py | ➕ 추가 | 프롬프트 전용 모듈 신규 생성 |
| utils/chatbot.py | 🔄 변경 | 프롬프트 import 방식으로 변경 |
| utils/tools.py | 🔄 변경 | predict_eclo 배치 지원 |
| utils/predictor.py | 🔄 변경 | 배치 예측 함수 추가 |
| 전체 | 🔧 개선 | 불필요한 import/함수 제거 |

---

## 5. 구현 우선순위

### 🔴 P0 - 핵심 (필수)

| 순위 | 항목 | 설명 |
|:-----|:-----|:-----|
| 1 | 프롬프트 모듈화 | `utils/prompts.py` 생성 및 분리 |
| 2 | 불필요한 코드 정리 | 미사용 import/함수 제거 |

### 🟡 P1 - 기능 확장

| 순위 | 항목 | 설명 |
|:-----|:-----|:-----|
| 3 | 배치 ECLO 예측 | N개 데이터 동시 추론 지원 |
| 4 | 배치 입력 파싱 | 자연어에서 여러 행 데이터 추출 |

### 🟢 P2 - 문서화

| 순위 | 항목 | 설명 |
|:-----|:-----|:-----|
| 5 | README.md 도구 목록 | 21개 도구 상세 설명 작성 |
| 6 | README.md 검토 | 프로젝트 구조 정확성 확인 |

---

## 6. 신규 파일 구조

```
utils/
├── prompts.py          # 신규: 프롬프트 모듈
│   ├── SYSTEM_PROMPT           # 메인 시스템 프롬프트
│   ├── ECLO_PREDICTION_PROMPT  # ECLO 예측 관련 프롬프트
│   └── TOOL_DESCRIPTIONS       # 도구별 설명 템플릿
├── chatbot.py          # 수정: prompts.py import
├── tools.py            # 수정: 배치 예측 지원
└── predictor.py        # 수정: predict_eclo_batch 함수 추가
```

---

## 7. 다음 단계

1. **P0 구현**: 프롬프트 모듈화, 코드 정리
2. **P1 구현**: 배치 ECLO 예측 기능
3. **P2 구현**: README.md 도구 목록 및 검토
4. **테스트**: 배치 예측 기능 통합 테스트
5. **문서화**: 사용자 가이드에 배치 예측 사용법 추가
