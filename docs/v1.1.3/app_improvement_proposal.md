# 대구 공공데이터 시각화 앱 개선 제안서 (v1.1.2 → v1.1.3)

**문서 버전**: v1.1.3
**작성일**: 2025-12-02
**참고 문서**: `docs/v1.1.3/notes.md`

---

## 1. 개요

본 문서는 대구 공공데이터 시각화 앱 v1.1.2의 현재 상태(AS-IS)와 v1.1.3에서 목표하는 개선 상태(TO-BE)를 비교 분석한다.

v1.1.3은 **UI 간소화** 및 **Tool Calling 피드백 버그 수정**에 초점을 맞춘다.

---

## 2. 기능별 AS-IS / TO-BE 비교

### 2.1 Tool Calling 피드백 위치

| 구분 | AS-IS (v1.1.2) | TO-BE (v1.1.3) |
|:-----|:---------------|:---------------|
| 피드백 위치 | 응답 텍스트 위에 표시 | 응답 텍스트 아래에 고정 표시 |
| 사용자 경험 | 응답 생성 시 상태값이 밑으로 밀림 | 상태값이 고정되어 자연스러운 흐름 |
| 구현 방식 | response_container와 별도 st.status | 응답 완료 후 상태 요약 표시 |

#### 2.1.1 현재 문제점

```
┌─────────────────────────────────────────────────────────────────┐
│  [User] 도로노선번호가 결측값인 데이터의 특성을 분석해줘          │
├─────────────────────────────────────────────────────────────────┤
│  [Assistant]                                                    │
│  분석 결과: (응답이 생성되면서...)                               │
│  ← 이 응답이 위에서 생성되어 아래 상태값을 밀어냄                 │
│                                                                 │
│  ✅ 도구 실행 완료 (0.1초)                                       │
│  🔄 1/3 analyze_missing_pattern 실행 중...                      │
│  ✅ 1/3 analyze_missing_pattern 완료 (0.02초)                   │
│  ...                                                            │
│  ← 이 상태값들이 채팅 밑으로 밀림                                │
└─────────────────────────────────────────────────────────────────┘
```

#### 2.1.2 개선 방안

```python
# AS-IS: 도구 상태가 응답 컨테이너와 분리되어 밀림
with st.chat_message('assistant'):
    response_container = st.empty()  # 응답 위치
    # ... tool_status가 별도로 생성되어 응답에 밀림

# TO-BE: 응답 완료 후 도구 실행 요약 표시
with st.chat_message('assistant'):
    response_container = st.empty()
    # 스트리밍 응답 완료 후
    response_container.markdown(full_response)
    # 도구 사용 시 요약 정보를 expander로 표시
    if tool_execution_info:
        with st.expander("🔧 사용된 도구", expanded=False):
            st.write(tool_summary)
```

---

### 2.2 프로젝트 개요 탭 단순화

| 구분 | AS-IS (v1.1.2) | TO-BE (v1.1.3) |
|:-----|:---------------|:---------------|
| 탭 구성 | 소개 + 업로드 + 교육 콘텐츠 | 소개 + 업로드 + 기술 스택만 유지 |
| 주요 기능 섹션 | 포함 | ➖ 삭제 |
| 사용 방법 섹션 | 포함 | ➖ 삭제 |
| 시스템 구조 섹션 | 포함 | ➖ 삭제 |
| 데이터 분석 기초 개념 | 6개 expander | ➖ 삭제 |
| 분석 가이드 질문 | 포함 | ➖ 삭제 |
| 교차 데이터 분석 중요성 | 포함 | ➖ 삭제 |

#### 2.2.1 삭제 대상 섹션 (app.py)

| 섹션명 | 라인 범위 | 설명 |
|:-------|:---------|:-----|
| 🎯 주요 기능 | 401-433 | 기능 소개 2컬럼 레이아웃 |
| 📚 사용 방법 | 435-451 | 3단계 사용 가이드 |
| 🏗️ 시스템 구조 | 482-511 | ASCII 아키텍처 다이어그램 |
| 📚 데이터 분석 기초 개념 | 515-677 | 6개 expander (데이터 타입, 통계 지표 등) |
| 🤔 분석 가이드 질문 | 681-701 | 분석 질문 예시 |
| 🔄 교차 데이터 분석 중요성 | 705-726 | 교차 분석 설명 |

#### 2.2.2 유지할 섹션

| 섹션명 | 설명 |
|:-------|:-----|
| 프로젝트 소개 | 대구 공공데이터 시각화 프로젝트 설명 |
| 📤 데이터 업로드 | 7개 데이터셋 업로드 위젯 |
| 🔧 기술 스택 | 프론트엔드, 데이터 처리, AI 기술 정보 |

---

### 2.3 교차 데이터 분석 탭 삭제

| 구분 | AS-IS (v1.1.2) | TO-BE (v1.1.3) |
|:-----|:---------------|:---------------|
| 탭 개수 | 10개 | 9개 |
| 교차 분석 탭 | "🔄 교차 데이터 분석" 포함 | ➖ 삭제 |
| 관련 함수 | render_cross_analysis_tab() 호출 | 호출 제거 (함수는 유지) |

#### 2.3.1 변경 전 탭 구성

```
📖 프로젝트 개요 | 🎥 CCTV | 💡 보안등 | 🏫 어린이 보호구역 |
🅿️ 주차장 | 🚗 사고 | 📊 훈련 데이터 | 📋 테스트 데이터 |
🔄 교차 데이터 분석 | 💬 데이터 질의응답
```

#### 2.3.2 변경 후 탭 구성

```
📖 프로젝트 개요 | 🎥 CCTV | 💡 보안등 | 🏫 어린이 보호구역 |
🅿️ 주차장 | 🚗 사고 | 📊 훈련 데이터 | 📋 테스트 데이터 |
💬 데이터 질의응답
```

---

## 3. 코드 품질 개선

### 3.1 Tool Calling 피드백 버그 수정

| 위치 | 문제 | AS-IS (v1.1.2) | TO-BE (v1.1.3) | 심각도 |
|:-----|:-----|:---------------|:---------------|:-------|
| `app.py:1224-1245` | 피드백 위치 오류 | st.status가 응답과 분리 | 응답 후 요약으로 변경 | 🔴 Error |

#### 3.1.1 수정 코드

```python
# AS-IS: 스트리밍 중 도구 상태 표시 (위치 문제 발생)
for chunk in stream_gen:
    if isinstance(chunk, dict):
        if '__tool_batch_start__' in chunk:
            tool_status = st.status("🔍 도구 탐색 중...", expanded=True)
        elif '__tool_start__' in chunk:
            tool_status.write(f"🔄 {info['index']}/{info['total']} ...")
        # ... 상태가 응답 위에 생성되어 밀림

# TO-BE: 도구 정보 수집 후 응답 완료 시 요약 표시
tool_executions = []  # 도구 실행 정보 수집

for chunk in stream_gen:
    if isinstance(chunk, dict):
        if '__tool_end__' in chunk:
            tool_executions.append(chunk['__tool_end__'])
        # ... 토큰 처리
    else:
        full_response += chunk
        response_container.markdown(full_response + "▌")

response_container.markdown(full_response)

# 도구 사용 요약을 응답 아래에 표시
if tool_executions:
    with st.expander(f"🔧 사용된 도구 ({len(tool_executions)}개)", expanded=False):
        for tool in tool_executions:
            st.write(f"✅ `{tool['name']}` ({tool['elapsed']:.2f}초)")
```

---

## 4. 변경 요약표

| 영역 | 변경 유형 | 내용 |
|:-----|:---------|:-----|
| Tool Calling 피드백 | 🐛 수정 | 응답 후 도구 요약 표시로 변경 |
| 프로젝트 개요 탭 | ➖ 제거 | 주요 기능, 사용방법, 시스템 구조, 기초 개념, 가이드 질문, 교차 분석 설명 삭제 |
| 교차 데이터 분석 탭 | ➖ 제거 | 탭 자체 삭제 (10개 → 9개) |

---

## 5. 구현 우선순위

### 🔴 P0 - 버그 수정 (필수)

| 순위 | 항목 | 설명 |
|:-----|:-----|:-----|
| 1 | Tool Calling 피드백 위치 수정 | 응답 후 도구 요약 표시로 변경 |

### 🟡 P1 - UI 간소화 (중요)

| 순위 | 항목 | 설명 |
|:-----|:-----|:-----|
| 2 | 프로젝트 개요 탭 단순화 | 불필요한 섹션 6개 삭제 |
| 3 | 교차 데이터 분석 탭 삭제 | 탭 목록에서 제거 |

---

## 6. 예상 탭 구조

```
┌─────────────────────────────────────────────────────────────────────────┐
│  📖 프로젝트 개요 │ 🎥 CCTV │ 💡 보안등 │ 🏫 어린이 보호구역 │ ...    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  프로젝트 개요 탭 (간소화)                                               │
│  ├─ 📝 프로젝트 소개 (유지)                                              │
│  ├─ 📤 데이터 업로드 (유지)                                              │
│  └─ 🔧 기술 스택 (유지)                                                  │
│                                                                         │
│  ❌ 삭제된 섹션                                                          │
│  ├─ 주요 기능                                                           │
│  ├─ 사용 방법                                                           │
│  ├─ 시스템 구조                                                         │
│  ├─ 데이터 분석 기초 개념 (6개 expander)                                 │
│  ├─ 분석 가이드 질문                                                    │
│  └─ 교차 데이터 분석의 중요성                                            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 7. 다음 단계

1. **P0 구현**: Tool Calling 피드백 위치 버그 수정
2. **P1 구현**: 프로젝트 개요 탭 단순화, 교차 데이터 분석 탭 삭제
3. **테스트**: 전체 기능 통합 테스트
4. **문서화**: README.md v1.1.3 업데이트
