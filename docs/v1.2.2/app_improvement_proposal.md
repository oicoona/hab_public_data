# 대구 공공데이터 시각화 앱 개선 제안서 (v1.2.1 → v1.2.2)

**문서 버전**: v1.2.2
**작성일**: 2025-12-08
**참고 문서**: `docs/v1.2.2/note.md`

---

## 1. 개요

본 문서는 대구 공공데이터 시각화 앱 v1.2.1의 현재 상태(AS-IS)와 v1.2.2에서 목표하는 개선 상태(TO-BE)를 비교 분석한다.

v1.2.2의 핵심 목표는 **ECLO 예측 기능을 데이터셋 독립적으로 개선**하여, 사용자가 어떤 데이터셋을 업로드했든 자연어 대화를 통해 ECLO 예측을 수행할 수 있도록 하는 것이다.

---

## 2. 기능별 AS-IS / TO-BE 비교

### 2.1 ECLO 예측 기능

| 구분 | AS-IS (v1.2.1) | TO-BE (v1.2.2) |
|:-----|:---------------|:---------------|
| **데이터셋 의존성** | train/test 데이터셋 업로드 필수 | 모든 데이터셋에서 사용 가능 |
| **모델 로딩** | 데이터셋 조건 검증 후 로딩 | 항상 `./model` 디렉토리에서 로딩 |
| **입력 방식** | 11개 피처 모두 명시적 제공 필요 | 자연어 대화로 점진적 입력 수집 |
| **사용자 경험** | 피처 누락 시 오류 발생 | 대화형 질문으로 누락 정보 수집 |

---

### 2.2 자연어 입력 처리

| 구분 | AS-IS (v1.2.1) | TO-BE (v1.2.2) |
|:-----|:---------------|:---------------|
| **의도 파악** | 명시적 도구 호출만 지원 | 자연어에서 ECLO 예측 의도 자동 감지 |
| **데이터 파싱** | LLM이 직접 파라미터 추출 | 자연어 → 구조화 데이터 변환 |
| **재질문 로직** | 없음 (오류 반환) | 누락 피처에 대해 자연어로 재질문 |

#### 2.2.1 예시 대화 흐름

**AS-IS (v1.2.1)**
```
사용자: 2022-01-01 토요일 맑음 대구 수성구 교차로 건조 차대사람 사고의 ECLO 예측해줘
AI: ECLO 예측은 train 또는 test 데이터셋에서만 사용 가능합니다.
```

**TO-BE (v1.2.2)**
```
사용자: 2022-01-01 토요일 맑음 대구 수성구 교차로 건조 차대사람 사고의 ECLO 예측해줘
AI: ECLO 예측을 위해 몇 가지 추가 정보가 필요합니다.
    - 사고 시간(시)은 몇 시인가요?
    - 시간대(새벽/아침/낮/저녁/밤)는 어떻게 되나요?
사용자: 새벽 1시야
AI: ## ECLO 예측 결과
    **예측된 ECLO 값**: 0.1234
    **해석**: 경미한 수준의 사고 심각도입니다.
    ...
```

---

### 2.3 모델 및 설정 파일 활용

| 구분 | AS-IS (v1.2.1) | TO-BE (v1.2.2) |
|:-----|:---------------|:---------------|
| **모델 파일** | 조건부 로딩 | 무조건 로딩 (`./model/*.pkl`) |
| **인코더** | 조건부 로딩 | 무조건 로딩 (`./model/encoders/`) |
| **feature_config.json** | 미활용 | 유효값 검증 및 재질문에 활용 |

---

## 3. 코드 품질 개선

### 3.1 도구 조건 검증 제거

| 위치 | AS-IS (v1.2.1) | TO-BE (v1.2.2) | 심각도 |
|:-----|:---------------|:---------------|:-------|
| `utils/tools.py:944-947` | 데이터셋 조건 검증 후 거부 | 조건 검증 제거, 항상 실행 | 🔧 개선 |

#### 3.1.1 코드 수정 상세

```python
# AS-IS
current_dataset = get_current_dataset_from_config(config)
if current_dataset not in ["train", "test"]:
    return "ECLO 예측은 train 또는 test 데이터셋에서만 사용 가능합니다..."

# TO-BE
# 데이터셋 조건 검증 제거 - 항상 예측 가능
```

---

### 3.2 피처 유효성 검증 강화

| 위치 | AS-IS (v1.2.1) | TO-BE (v1.2.2) | 심각도 |
|:-----|:---------------|:---------------|:-------|
| `utils/predictor.py` | 기본 타입 검증만 | feature_config.json 기반 유효값 검증 | 🔧 개선 |

---

## 4. 변경 요약표

| 영역 | 변경 유형 | 내용 |
|:-----|:---------|:-----|
| ECLO 예측 도구 | 🔧 개선 | 데이터셋 의존성 제거 |
| 자연어 처리 | ➕ 추가 | 의도 감지 및 재질문 로직 |
| 모델 로딩 | 🔄 변경 | 무조건 로딩 방식으로 변경 |
| feature_config.json | 🔧 개선 | 유효값 검증에 활용 |

---

## 5. 구현 우선순위

### 🔴 P0 - 핵심 기능 (필수)

| 순위 | 항목 | 설명 |
|:-----|:-----|:-----|
| 1 | 데이터셋 조건 검증 제거 | `predict_eclo` 도구에서 데이터셋 검증 로직 제거 |
| 2 | 모델 무조건 로딩 | `./model` 디렉토리에서 항상 모델/인코더 로딩 |

### 🟡 P1 - 사용자 경험 개선

| 순위 | 항목 | 설명 |
|:-----|:-----|:-----|
| 3 | 자연어 의도 감지 | ECLO 예측 의도를 자연어에서 자동 감지 |
| 4 | 피처 재질문 로직 | 누락된 피처에 대해 대화형 질문 |

### 🟢 P2 - 품질 향상

| 순위 | 항목 | 설명 |
|:-----|:-----|:-----|
| 5 | feature_config.json 활용 | 유효값 목록으로 입력 검증 |
| 6 | 에러 메시지 개선 | 사용자 친화적 오류 안내 |

---

## 6. 필요 파일 구조

```
model/
├── eclo_model.pkl           # ECLO 예측 모델
├── feature_config.json      # 피처 유효값 설정
└── encoders/
    ├── weather_encoder.pkl      # 기상상태 인코더
    ├── road_surface_encoder.pkl # 노면상태 인코더
    ├── road_type_encoder.pkl    # 도로형태 인코더
    ├── accident_type_encoder.pkl # 사고유형 인코더
    ├── time_period_encoder.pkl  # 시간대 인코더
    ├── district_encoder.pkl     # 시군구 인코더
    └── day_of_week_encoder.pkl  # 요일 인코더
```

---

## 7. 다음 단계

1. **P0 구현**: 데이터셋 조건 검증 제거 및 모델 무조건 로딩
2. **P1 구현**: 자연어 의도 감지 및 재질문 로직 추가
3. **P2 구현**: feature_config.json 기반 유효값 검증
4. **테스트**: 다양한 데이터셋 환경에서 ECLO 예측 테스트
5. **문서화**: 사용자 가이드에 ECLO 예측 사용법 추가
